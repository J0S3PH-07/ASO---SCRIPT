version: '3.8'

services:
  # Servidor LDAP principal
  openldap:
    image: osixia/openldap:latest
    container_name: ldap-server
    environment:
      LDAP_ORGANISATION: "Tecnosolutions"
      LDAP_DOMAIN: "tecnosolutions.com"
      LDAP_ADMIN_PASSWORD: "admin"
      # Opcional: Configuración para logs y base de datos
    ports:
      - "389:389"
      - "636:636"
    networks:
      - ldap-network

  # Interfaz gráfica de administración
  phpldapadmin:
    image: osixia/phpldapadmin:latest
    container_name: phpldapadmin
    environment:
      PHPLDAPADMIN_LDAP_HOSTS: "openldap"
      PHPLDAPADMIN_HTTPS: "false"
    ports:
      - "8080:80"
    depends_on:
      - openldap
    networks:
      - ldap-network

  # Cliente para ejecutar scripts
  ldap-client:
    image: debian:latest
    container_name: ldap-client
    # Mantiene el contenedor vivo e instala herramientas necesarias al inicio
    command: >
      bash -c "apt-get update && apt-get install -y ldap-utils nano && tail -f /dev/null"
    volumes:
      # Montamos el directorio actual en /scripts dentro del contenedor
      - ./:/scripts
    working_dir: /scripts
    networks:
      - ldap-network

networks:
  ldap-network:
    driver: bridge
